/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.7/userguide/building_java_projects.html
 */

plugins {
    id 'groovy'
    id 'application'
    id 'maven-publish'
}

version = '1.0.1'
group = 'io.seqera'

java {
    sourceCompatibility = JavaVersion.toVersion('1.8')
    targetCompatibility = JavaVersion.toVersion('1.8')
}

repositories {
    mavenCentral()
}

dependencies {
    // This dependency is used by the application.
    implementation "ch.qos.logback:logback-classic:1.2.3"
    runtimeOnly 'mysql:mysql-connector-java:8.0.22'
    runtimeOnly 'org.mariadb.jdbc:mariadb-java-client:2.7.4'
    runtimeOnly 'com.h2database:h2:1.4.200'

    // Use the latest Groovy version for Spock testing
    testImplementation 'org.codehaus.groovy:groovy-all:3.0.8'
    testImplementation 'org.spockframework:spock-core:2.0-groovy-3.0'
    testImplementation "org.testcontainers:testcontainers:1.16.0"

    // Dummy library containing some migration files among their resources for testing purposes
    testImplementation files("libs/jar-with-resources.jar")
}

test {
    useJUnitPlatform()
    testLogging {
        events "passed", "skipped", "failed"
    }
}

application {
    // Define the main class for the application.
    mainClass = 'io.seqera.migtool.App'
}

ext.aws_access_key_id = project.findProperty('aws_access_key_id') ?: System.getenv('AWS_ACCESS_KEY_ID')
ext.aws_secret_access_key = project.findProperty('aws_secret_access_key') ?: System.getenv('AWS_SECRET_ACCESS_KEY')
ext.publishRepoUrl = project.findProperty('publish_repo_url') ?: System.getenv('PUBLISH_REPO_URL') ?: ( version.endsWith('-SNAPSHOT') ? "s3://maven.seqera.io/snapshots" : "s3://maven.seqera.io/releases" )

jar {
    from sourceSets.main.allSource
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }
    repositories {
        maven {
            url = publishRepoUrl
            credentials(AwsCredentials) {
                // keys are defined in the `gradle.properties` file
                accessKey aws_access_key_id
                secretKey aws_secret_access_key
            }
        }
    }
}
